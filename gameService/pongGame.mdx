---
title: "Pong 게임 구현"
date: "2023-06-19"
tags: ["Project"]
---

## 게임을 구현하기에 앞서

- 게임의 연산은 어떻게 처리해야할까?

- 게임의 연산은 42과제중에 cub3d라는 과제가 있다. 2차원 배열의 맵을 파싱하고 그걸 3D로 보여주는 과제인데, 이거를 할때 일반각을 구해 회전횡렬을 구현한 경험이 있다. 이 경험을 토대로 공의 위치가 벽에 충돌을 할때 방향 벡터에 일반각을 곱해주는 방식으로 구현했다.

## 게임의 연산의 주체는 누가?

- 여기서 이제 방법이 여러가지가 있다고 생각한다.

- 서버에서 연산을 해서 게임 룸에 접속한 유저들에게 위치데이터를 뿌려주는 방식이 있고, 호스트에서 연산을 하고, 서버에서 데이터를 받아 룸에 접속한 유저들에게 뿌려주는 방식이 있다.

- 나는 일단 호스트에서 연산하는 방식을 선택을 했다... 그 이유는 여러 이유가 있지만
  - 백엔드 개발자분들이 웹서비스를 처음 만들어보시는 분들이라 부담을 덜어주고 싶은 이유도 있었다.
  - 다른 이유로는 데이터의 진실성이다. 데이터의 진실성은 어떠한 데이터를 받았을때 이 데이터가 변질되지 않았나에 대한 판단때문이다.
  - 그리고 서버의 부담을 줄이고 싶었다. 서버에 부담을 늘리면 늘릴수록 어플리케이션 전체적으로 느려질 것 같다는 생각을 하게 되었다.

## 호스트 연산 방식

- 게임 룸이 생성이 되면 host와 guest가 생성이 된다고 가정을 했다. host쪽에서 모든 연산을 하고 연산결과값을 33ms(30fps)마다 캔버스를 그리는데 필요한 공위치 패들 위치데이터를 Socket서버에 보내고 Socket서버는 게임룸에 접속한 guest에게 보내주는 방식으로 구현했다.

- 그렇다면 Guest는 무엇을 할까?
  - 데이터를 받아서 canvas를 그리는 작업과 그리고 key event가 발생했을때 Socket 서버에 "나 무슨키 눌렀어."라는 key event를 보내면 Socket Server에서 host로 보내게 된다. 그리고 그 받은 데이터를 기반으로 패들의 위치를 연산하고 그 결과값은 33ms마다 보내는 결과값에 반영이 되서 전달이 된다

## Flow

### Host

- while Host -> Server -> Guest

### Key event

- Guest -> Server -> Host
